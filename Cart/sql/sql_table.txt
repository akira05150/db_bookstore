
BOOK

CREATE TABLE `bookstoredb`.`book` ( `ISBN` CHAR(13) NOT NULL , `Title` VARCHAR(50) NOT NULL , `Publisher` VARCHAR(20) NOT NULL , `Pdate` DATE NOT NULL , `Cover` VARCHAR(255) NOT NULL , `Intro` VARCHAR(3000) NULL , `Sells` INT NOT NULL , `Stock` INT NOT NULL , `Price` INT NOT NULL , PRIMARY KEY (`ISBN`), UNIQUE (`Cover`)) ENGINE = InnoDB;

AUTHOR

CREATE TABLE `bookstoredb`.`author` ( `Aid` INT NOT NULL AUTO_INCREMENT , `Aname` VARCHAR(30) NOT NULL , `Aintro` VARCHAR(1000) NULL , PRIMARY KEY (`Aid`)) ENGINE = InnoDB;

WRITTEN

CREATE TABLE `bookstoredb`.`written` ( `ISBN` VARCHAR(13) NOT NULL , `Aid` INT NOT NULL , PRIMARY KEY (`ISBN`, `Aid`), ) ENGINE = InnoDB;

ALTER TABLE `written` ADD FOREIGN KEY (`ISBN`) REFERENCES `book`(`ISBN`) ON DELETE CASCADE ON UPDATE CASCADE; ALTER TABLE `written` ADD FOREIGN KEY (`Aid`) REFERENCES `author`(`Aid`) ON DELETE CASCADE ON UPDATE CASCADE;


# 找類別中新書
SELECT BOOK.Title,BOOK.Pdate, TYPE.Catagory, TYPE.Subcatagory
FROM BOOK
INNER JOIN TYPE
ON BOOK.ISBN=type.ISBN
WHERE TYPE.Subcatagory='文學' AND TYPE.Catagory='中文書'
ORDER BY BOOK.Pdate DESC
;

# 查詢
(SELECT BOOK.ISBN, BOOK.Title, BOOK.Publisher, BOOK.Price, AUTHOR.Aname
FROM (BOOK
	INNER JOIN WRITTEN
	ON BOOK.ISBN=WRITTEN.ISBN
	)
    INNER JOIN AUTHOR
	ON AUTHOR.Aid=WRITTEN.Aid
WHERE AUTHOR.Aname LIKE '%乙一%')
UNION
(SELECT BOOK.ISBN, BOOK.Title, BOOK.Publisher, BOOK.Price, AUTHOR.Aname
FROM (BOOK
	INNER JOIN WRITTEN
	ON BOOK.ISBN=WRITTEN.ISBN
	)
    INNER JOIN AUTHOR
	ON AUTHOR.Aid=WRITTEN.Aid
WHERE BOOK.Title LIKE '%乙一%')
;

# 新增CART表格
CREATE TABLE `bookstoredb`.`cart` ( `ISBN` CHAR(13) NOT NULL , `Uid` VARCHAR(14) NOT NULL , `Quantity` INT NOT NULL , PRIMARY KEY (`ISBN`, `Uid`)) ENGINE = InnoDB;

# USER 表格
CREATE TABLE `bookstoredb`.`user` ( `Uid` CHAR(14) NOT NULL , `Account_name` VARCHAR(20) NULL , `Email` VARCHAR(50) NULL , `Password` VARCHAR(50) NULL , PRIMARY KEY (`Uid`), UNIQUE (`Account_name`), UNIQUE (`Email`)) ENGINE = InnoDB;

# UID是否存在
SELECT Uid FROM USER WHERE Uid IN ('160d0acae153e4');
INSERT INTO USER (Uid) VALUES ('160d0acae153e4');

# 加入購物車
INSERT INTO CART (ISBN, Uid, Quantity) VALUES ('9789573337362', '160d0acae153e4', 1);

# 更新購物車內容
UPDATE CART SET Quantity='2' WHERE ISBN='9789865524951' AND Uid='160d0ec6dd5c3f';

SELECT * FROM CART WHERE ISBN='9789865524951' AND Uid='160d0ec6dd5c3f';

# 刪除購物車內容
DELETE FROM CART
WHERE  ISBN='9789865524951' AND Uid='160d0ec6dd5c3f';

SELECT * FROM CART WHERE ISBN='9789865524951' AND Uid='160d0ec6dd5c3f';

// 查詢uid內所有購買資訊
$sql_orderlist = "SELECT * FROM CART WHERE Uid='160d0fba09368d'";

//設定AC初值
alter table users AUTO_INCREMENT=10000;

alter table orders AUTO_INCREMENT=10001;

// 將資料加入ORDERS

INSERT INTO ORDERS (Onum, ISBN, Uid, Quantity, Subtotal) VALUES ('', '', '',,);
